{% extends 'master.html' %}
{% load i18n %}
{% block content %}


    <div class="row container center-block">
        <h1 class="text-default text-center">{% trans "Plan overview" %}</h1>

        <div class="panel col-md-12">
            <table class="table table-responsive">
                {% for a in activities %}
                    <tr>
                    <td>
                    <div class="">
                        <div class="  col-md-2">
                            <img class="scape-top-custom img-export img-rounded" src="{{ MEDIA_URL }}{{ a.photo }}"/>
                        </div>

                        <div id="address" class="col-md-4 container center-block text-center">
                            <address>
                                <p><strong>{{ a.name }}</strong></p>

                                <p>  {% trans "Location:" %}{{ a.location }}</p>
                                <abbr title="Phone">{% trans "Web Page: " %}</abbr> {{ a.url }}
                            </address>
                        </div>
                    </div>
                {% endfor %}


                <span id="email" data-toggle="tooltip" data-placement="left" title="{% trans "Send plan to email" %}"
                      class="glyphicon glyphicon-envelope glyphicon-topright" onclick="send();"></span>
            <span id="print" data-toggle="tooltip" data-placement="left" title="{% trans "Print your plan" %}"
                  class="glyphicon glyphicon-envelope glyphicon-topright2 glyphicon-print" onclick="pr();"></span>
                </tr>
            </table>
        </div>


    </div>

    <div id="map-canvas" class="google-map-canvas">
    </div>

    <script>
        function pr() {


            //$('#email').hide();
            //$('.img-export').hide();
            window.print();
            $('#print').visible = true;
            //$('#email').visible=true;
            //$('.img-export').visible=true;

        }
    </script>

    <style type="text/css">

        html, body, #map-canvas {
            height: 100%;
            margin: 0px;
            padding: 0px;

        }

        #map-canvas {
            height: 40%;
            width: 70%;
            margin-left: 15%;
            margin-bottom: 15%;

        }

        #map-canvas:hover {
            box-shadow: inset 0 1px 1px orange, 0 0 8px orange;
            -moz-box-shadow: inset 0 1px 1px orange, 0 0 8px orange;
            webkit-box-shadow: inset 0 1px 1px orange, 0 0 8px orange;

        }
    </style>
    <script
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD3MNe0d97ZOIvfcbqJ1dBGVyAM14KsTtA&sensor=false">
    </script>

    <script>
        var directionsDisplay;
        var directionsService = new google.maps.DirectionsService();
        var map;
        function initialize() {
            directionsDisplay = new google.maps.DirectionsRenderer();
            var mapOptions = {
                zoom: 8,
                center: new google.maps.LatLng(-34.397, 150.644)
            };
            map = new google.maps.Map(document.getElementById('map-canvas'),
                    mapOptions);

            directionsDisplay.setMap(map);
            calcRoute();
        }
        google.maps.event.addDomListener(window, 'load', initialize);

        function calcRoute() {
            var lat;
            var lon;
            var latr;
            var lonr;
            var start;
            var end;
            var wps = [];

            var wp1;

            {% for p in plan.activities.all %}

                {% if forloop.first %}

                    lat = '{{ p.latitude }}';
                    lon = '{{ p.longitude }}';
                    latr = lat.replace(",", ".");
                    lonr = lon.replace(",", ".");
                    start = new google.maps.LatLng(latr, lonr);
                {% elif forloop.last %}

                    lat = '{{ p.latitude }}';
                    lon = '{{ p.longitude }}';
                    latr = lat.replace(",", ".");
                    lonr = lon.replace(",", ".");
                    end = new google.maps.LatLng(latr, lonr);

                {% else %}

                    lat = '{{ p.latitude }}';
                    lon = '{{ p.longitude }}';
                    latr = lat.replace(",", ".");
                    lonr = lon.replace(",", ".");
                    wp1 = new google.maps.LatLng(latr, lonr);

                    wps.push({location: wp1});

                {% endif %}

            {% endfor %}

            var request = {
                origin: start,
                destination: end,
                waypoints: wps,
                optimizeWaypoints: true,
                travelMode: google.maps.TravelMode.DRIVING
            };

            directionsService.route(request, function (result, status) {
                if (status == google.maps.DirectionsStatus.OK) {
                    directionsDisplay.setDirections(result);
                }
            });

        }


    </script>



{% endblock %}