{% extends 'master.html' %}
{% load i18n %}
{% block content %}

    <div class="row center-block container scape-top-custom ">

        <h1>{% trans "Pocket plans" %}</h1>

        {% for elem in userplans %}
            <table>
                <tr>
                    <h2>{{ elem.plan.name }}</h2>
                    <h4>
                        <a href="/planinfo/{{ elem.plan.id }}" class="glyphicon glyphicon-search text-darkorange "></a>
                        <a data-toggle="modal" data-target="#myModal{{ elem.plan.pk }}"
                           class="glyphicon glyphicon-share text-darkorange"></a>
                        <a href="/mod_plan/{{ elem.plan.id }}" class="glyphicon glyphicon-edit text-darkorange"></a>
                    </h4>
                    {% for a in elem.activities %}

                        <td>
                            <div>
                                <a href="{% url 'activity_info' activity_id=a.id %}">
                                    <img src="{{ MEDIA_URL }}{{ a.photo }}"
                                         style="height: 220px;width: 220px;"/>
                                </a>
                            </div>
                        </td>
                    {% endfor %}
                    <td>
                        <div class=" col-md-8">


                            <button type="button" class="btn btn-default" data-container="body"
                                    data-toggle="popover" data-placement="left"
                                    data-content=" {% for s in elem.plan.sharedTo.all %}
                                            {{ s.djangoUser }}, {% empty %} not shared
                                             {% endfor %}">
                                shared
                            </button>


                        </div>
                    </td>
                </tr>

            </table>

            <div class="modal fade" id="myModal{{ elem.plan.pk }}" tabindex="-1" role="dialog"
                 aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h4 class="modal-title" id="myModalLabel">{{ elem.name }}</h4>
                        </div>
                        <div class="modal-body">
                            <form class="form-horizontal" action="" method="post">{% csrf_token %}
                                <input type="hidden" name="plan" value="{{ elem.plan.pk }}">
                                {% trans "Select the friends to share" %}
                                <table class="form-inline">
                                    {% for p in friends %}
                                        {% if p not in elem.plan.sharedTo.all %}
                                            <tr>
                                                <td>

                                                    <div>
                                                        <img src="/media/{{ p.image }}"
                                                             class="img-xs-custom img-rounded"></div>
                                                </td>
                                                <td>

                                                    <div> {{ p.djangoUser }}    </div>
                                                </td>
                                                <td><input type="checkbox" name="user"
                                                           value="{{ p.pk }}">
                                            </div>
                                            </td>
                                            </tr>
                                        {% endif %}
                                    {% empty %}
                                        <p>{% trans "You donÂ´t have friends to share this plan" %}</p>

                                    {% endfor %}
                        </table>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default"
                                    data-dismiss="modal">{% trans "Close" %}</button>
                            <input type="submit" class="btn btn-primary" value="{% trans "Share" %}"
                                   name="share">
                        </div>

                        </form>
                    </div>


                </div>
            </div>
            </div>
        {% endfor %}

    </div>

    <!-- Modal -->

    <script>
        $('[data-toggle="popover"]').popover({
            'placement': 'top'
        });
    </script>

{% endblock %}
